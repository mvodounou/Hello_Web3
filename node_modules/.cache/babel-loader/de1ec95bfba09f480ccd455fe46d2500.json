{"ast":null,"code":"/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * @file formatters.js\n * @author Fabian Vogelsteller <fabian@ethereum.org>\n * @author Marek Kotewicz <marek@parity.io>\n * @date 2017\n */\n\"use strict\";\n\nvar utils = require('web3-utils');\n\nvar Iban = require('web3-eth-iban');\n/**\n * Will format the given storage key array values to hex strings.\n *\n * @method inputStorageKeysFormatter\n *\n * @param {Array<Number|String|BN|BigNumber>} keys\n *\n * @returns {Array<String>}\n */\n\n\nvar inputStorageKeysFormatter = function (keys) {\n  return keys.map(utils.numberToHex);\n};\n/**\n * Will format the given proof response from the node.\n *\n * @method outputProofFormatter\n *\n * @param {object} proof\n *\n * @returns {object}\n */\n\n\nvar outputProofFormatter = function (proof) {\n  proof.address = utils.toChecksumAddress(proof.address);\n  proof.nonce = utils.hexToNumberString(proof.nonce);\n  proof.balance = utils.hexToNumberString(proof.balance);\n  return proof;\n};\n/**\n * Should the format output to a big number\n *\n * @method outputBigNumberFormatter\n *\n * @param {String|Number|BigNumber|BN} number\n *\n * @returns {BN} object\n */\n\n\nvar outputBigNumberFormatter = function (number) {\n  return utils.toBN(number).toString(10);\n};\n/**\n * Returns true if the given blockNumber is 'latest', 'pending', 'earliest, 'finalized' or 'safe'\n *\n * @method isPredefinedBlockNumber\n *\n * @param {String} blockNumber\n *\n * @returns {Boolean}\n */\n\n\nvar isPredefinedBlockNumber = function (blockNumber) {\n  return ['latest', 'pending', 'earliest', 'finalized', 'safe'].includes(blockNumber);\n};\n/**\n * Returns the given block number as hex string or does return the defaultBlock property of the current module\n *\n * @method inputDefaultBlockNumberFormatter\n *\n * @param {String|Number|BN|BigNumber} blockNumber\n *\n * @returns {String}\n */\n\n\nvar inputDefaultBlockNumberFormatter = function (blockNumber) {\n  if (this && (blockNumber === undefined || blockNumber === null)) {\n    return inputBlockNumberFormatter(this.defaultBlock);\n  }\n\n  return inputBlockNumberFormatter(blockNumber);\n};\n/**\n * Returns the given block number as hex string or the predefined block number 'latest', 'pending', 'earliest', 'finalized', 'safe', 'genesis'\n *\n * @param {String|Number|BN|BigNumber} blockNumber\n *\n * @returns {String}\n */\n\n\nvar inputBlockNumberFormatter = function (blockNumber) {\n  if (blockNumber === undefined) {\n    return undefined;\n  }\n\n  if (isPredefinedBlockNumber(blockNumber)) {\n    return blockNumber;\n  }\n\n  if (blockNumber === 'genesis') {\n    return '0x0';\n  }\n\n  return utils.isHexStrict(blockNumber) ? typeof blockNumber === 'string' ? blockNumber.toLowerCase() : blockNumber : utils.numberToHex(blockNumber);\n};\n/**\n * Formats the input of a transaction and converts all values to HEX\n *\n * @method _txInputFormatter\n * @param {Object} transaction options\n * @returns object\n */\n\n\nvar _txInputFormatter = function (options) {\n  if (options.to) {\n    // it might be contract creation\n    options.to = inputAddressFormatter(options.to);\n  }\n\n  if (options.data && options.input) {\n    throw new Error('You can\\'t have \"data\" and \"input\" as properties of transactions at the same time, please use either \"data\" or \"input\" instead.');\n  }\n\n  if (!options.data && options.input) {\n    options.data = options.input;\n    delete options.input;\n  }\n\n  if (options.data && !options.data.startsWith('0x')) {\n    options.data = '0x' + options.data;\n  }\n\n  if (options.data && !utils.isHex(options.data)) {\n    throw new Error('The data field must be HEX encoded data.');\n  } // allow both\n\n\n  if (options.gas || options.gasLimit) {\n    options.gas = options.gas || options.gasLimit;\n  }\n\n  if (options.maxPriorityFeePerGas || options.maxFeePerGas) {\n    delete options.gasPrice;\n  }\n\n  ['gasPrice', 'gas', 'value', 'maxPriorityFeePerGas', 'maxFeePerGas', 'nonce'].filter(function (key) {\n    return options[key] !== undefined;\n  }).forEach(function (key) {\n    options[key] = utils.numberToHex(options[key]);\n  });\n  return options;\n};\n/**\n * Formats the input of a transaction and converts all values to HEX\n *\n * @method inputCallFormatter\n * @param {Object} transaction options\n * @returns object\n */\n\n\nvar inputCallFormatter = function (options) {\n  options = _txInputFormatter(options);\n  var from = options.from || (this ? this.defaultAccount : null);\n\n  if (from) {\n    options.from = inputAddressFormatter(from);\n  }\n\n  return options;\n};\n/**\n * Formats the input of a transaction and converts all values to HEX\n *\n * @method inputTransactionFormatter\n * @param {Object} options\n * @returns object\n */\n\n\nvar inputTransactionFormatter = function (options) {\n  options = _txInputFormatter(options); // check from, only if not number, or object\n\n  if (!(typeof options.from === 'number') && !(!!options.from && typeof options.from === 'object')) {\n    options.from = options.from || (this ? this.defaultAccount : null);\n\n    if (!options.from && !(typeof options.from === 'number')) {\n      throw new Error('The send transactions \"from\" field must be defined!');\n    }\n\n    options.from = inputAddressFormatter(options.from);\n  }\n\n  return options;\n};\n/**\n * Hex encodes the data passed to eth_sign and personal_sign\n *\n * @method inputSignFormatter\n * @param {String} data\n * @returns {String}\n */\n\n\nvar inputSignFormatter = function (data) {\n  return utils.isHexStrict(data) ? data : utils.utf8ToHex(data);\n};\n/**\n * Formats the output of a transaction to its proper values\n *\n * @method outputTransactionFormatter\n * @param {Object} tx\n * @returns {Object}\n */\n\n\nvar outputTransactionFormatter = function (tx) {\n  if (tx.blockNumber !== null) tx.blockNumber = utils.hexToNumber(tx.blockNumber);\n  if (tx.transactionIndex !== null) tx.transactionIndex = utils.hexToNumber(tx.transactionIndex);\n  tx.nonce = utils.hexToNumber(tx.nonce);\n  tx.gas = utils.hexToNumber(tx.gas);\n  if (tx.gasPrice) tx.gasPrice = outputBigNumberFormatter(tx.gasPrice);\n  if (tx.maxFeePerGas) tx.maxFeePerGas = outputBigNumberFormatter(tx.maxFeePerGas);\n  if (tx.maxPriorityFeePerGas) tx.maxPriorityFeePerGas = outputBigNumberFormatter(tx.maxPriorityFeePerGas);\n  if (tx.type) tx.type = utils.hexToNumber(tx.type);\n  tx.value = outputBigNumberFormatter(tx.value);\n\n  if (tx.to && utils.isAddress(tx.to)) {\n    // tx.to could be `0x0` or `null` while contract creation\n    tx.to = utils.toChecksumAddress(tx.to);\n  } else {\n    tx.to = null; // set to `null` if invalid address\n  }\n\n  if (tx.from) {\n    tx.from = utils.toChecksumAddress(tx.from);\n  }\n\n  return tx;\n};\n/**\n * Formats the output of a transaction receipt to its proper values\n *\n * @method outputTransactionReceiptFormatter\n * @param {Object} receipt\n * @returns {Object}\n */\n\n\nvar outputTransactionReceiptFormatter = function (receipt) {\n  if (typeof receipt !== 'object') {\n    throw new Error('Received receipt is invalid: ' + receipt);\n  }\n\n  if (!this.hexFormat) {\n    if (receipt.blockNumber !== null) receipt.blockNumber = utils.hexToNumber(receipt.blockNumber);\n    if (receipt.transactionIndex !== null) receipt.transactionIndex = utils.hexToNumber(receipt.transactionIndex);\n    receipt.cumulativeGasUsed = utils.hexToNumber(receipt.cumulativeGasUsed);\n    receipt.gasUsed = utils.hexToNumber(receipt.gasUsed);\n\n    if (receipt.effectiveGasPrice) {\n      receipt.effectiveGasPrice = utils.hexToNumber(receipt.effectiveGasPrice);\n    }\n  }\n\n  if (Array.isArray(receipt.logs)) {\n    receipt.logs = receipt.logs.map(outputLogFormatter);\n  }\n\n  if (receipt.contractAddress) {\n    receipt.contractAddress = utils.toChecksumAddress(receipt.contractAddress);\n  }\n\n  if (typeof receipt.status !== 'undefined' && receipt.status !== null) {\n    receipt.status = Boolean(parseInt(receipt.status));\n  }\n\n  return receipt;\n};\n/**\n * Formats the output of a block to its proper values\n *\n * @method outputBlockFormatter\n * @param {Object} block\n * @returns {Object}\n */\n\n\nvar outputBlockFormatter = function (block) {\n  // transform to number\n  block.gasLimit = utils.hexToNumber(block.gasLimit);\n  block.gasUsed = utils.hexToNumber(block.gasUsed);\n  block.size = utils.hexToNumber(block.size);\n  block.timestamp = utils.hexToNumber(block.timestamp);\n  if (block.number !== null) block.number = utils.hexToNumber(block.number);\n  if (block.difficulty) block.difficulty = outputBigNumberFormatter(block.difficulty);\n  if (block.totalDifficulty) block.totalDifficulty = outputBigNumberFormatter(block.totalDifficulty);\n\n  if (Array.isArray(block.transactions)) {\n    block.transactions.forEach(function (item) {\n      if (!(typeof item === 'string')) return outputTransactionFormatter(item);\n    });\n  }\n\n  if (block.miner) block.miner = utils.toChecksumAddress(block.miner);\n  if (block.baseFeePerGas) block.baseFeePerGas = utils.hexToNumber(block.baseFeePerGas);\n  return block;\n};\n/**\n * Formats the input of a log\n *\n * @method inputLogFormatter\n * @param {Object} log object\n * @returns {Object} log\n */\n\n\nvar inputLogFormatter = function (options) {\n  var toTopic = function (value) {\n    if (value === null || typeof value === 'undefined') return null;\n    value = String(value);\n    if (value.indexOf('0x') === 0) return value;else return utils.fromUtf8(value);\n  };\n\n  if (options === undefined) options = {}; // If options !== undefined, don't blow out existing data\n\n  if (options.fromBlock === undefined) options = { ...options,\n    fromBlock: 'latest'\n  };\n  if (options.fromBlock || options.fromBlock === 0) options.fromBlock = inputBlockNumberFormatter(options.fromBlock);\n  if (options.toBlock || options.toBlock === 0) options.toBlock = inputBlockNumberFormatter(options.toBlock); // make sure topics, get converted to hex\n\n  options.topics = options.topics || [];\n  options.topics = options.topics.map(function (topic) {\n    return Array.isArray(topic) ? topic.map(toTopic) : toTopic(topic);\n  });\n  toTopic = null;\n\n  if (options.address) {\n    options.address = Array.isArray(options.address) ? options.address.map(function (addr) {\n      return inputAddressFormatter(addr);\n    }) : inputAddressFormatter(options.address);\n  }\n\n  return options;\n};\n/**\n * Formats the output of a log\n *\n * @method outputLogFormatter\n * @param {Object} log object\n * @returns {Object} log\n */\n\n\nvar outputLogFormatter = function (log) {\n  // generate a custom log id\n  if (typeof log.blockHash === 'string' && typeof log.transactionHash === 'string' && typeof log.logIndex === 'string') {\n    var shaId = utils.sha3(log.blockHash.replace('0x', '') + log.transactionHash.replace('0x', '') + log.logIndex.replace('0x', ''));\n    log.id = 'log_' + shaId.replace('0x', '').slice(0, 8);\n  } else if (!log.id) {\n    log.id = null;\n  }\n\n  if (log.blockNumber !== null) log.blockNumber = utils.hexToNumber(log.blockNumber);\n  if (log.transactionIndex !== null) log.transactionIndex = utils.hexToNumber(log.transactionIndex);\n  if (log.logIndex !== null) log.logIndex = utils.hexToNumber(log.logIndex);\n\n  if (log.address) {\n    log.address = utils.toChecksumAddress(log.address);\n  }\n\n  return log;\n};\n/**\n * Formats the input of a whisper post and converts all values to HEX\n *\n * @method inputPostFormatter\n * @param {Object} transaction object\n * @returns {Object}\n */\n\n\nvar inputPostFormatter = function (post) {\n  // post.payload = utils.toHex(post.payload);\n  if (post.ttl) post.ttl = utils.numberToHex(post.ttl);\n  if (post.workToProve) post.workToProve = utils.numberToHex(post.workToProve);\n  if (post.priority) post.priority = utils.numberToHex(post.priority); // fallback\n\n  if (!Array.isArray(post.topics)) {\n    post.topics = post.topics ? [post.topics] : [];\n  } // format the following options\n\n\n  post.topics = post.topics.map(function (topic) {\n    // convert only if not hex\n    return topic.indexOf('0x') === 0 ? topic : utils.fromUtf8(topic);\n  });\n  return post;\n};\n/**\n * Formats the output of a received post message\n *\n * @method outputPostFormatter\n * @param {Object}\n * @returns {Object}\n */\n\n\nvar outputPostFormatter = function (post) {\n  post.expiry = utils.hexToNumber(post.expiry);\n  post.sent = utils.hexToNumber(post.sent);\n  post.ttl = utils.hexToNumber(post.ttl);\n  post.workProved = utils.hexToNumber(post.workProved); // post.payloadRaw = post.payload;\n  // post.payload = utils.hexToAscii(post.payload);\n  // if (utils.isJson(post.payload)) {\n  //     post.payload = JSON.parse(post.payload);\n  // }\n  // format the following options\n\n  if (!post.topics) {\n    post.topics = [];\n  }\n\n  post.topics = post.topics.map(function (topic) {\n    return utils.toUtf8(topic);\n  });\n  return post;\n};\n\nvar inputAddressFormatter = function (address) {\n  var iban = new Iban(address);\n\n  if (iban.isValid() && iban.isDirect()) {\n    return iban.toAddress().toLowerCase();\n  } else if (utils.isAddress(address)) {\n    return '0x' + address.toLowerCase().replace('0x', '');\n  }\n\n  throw new Error(`Provided address ${address} is invalid, the capitalization checksum test failed, or it's an indirect IBAN address which can't be converted.`);\n};\n\nvar outputSyncingFormatter = function (result) {\n  result.startingBlock = utils.hexToNumber(result.startingBlock);\n  result.currentBlock = utils.hexToNumber(result.currentBlock);\n  result.highestBlock = utils.hexToNumber(result.highestBlock);\n\n  if (result.knownStates) {\n    result.knownStates = utils.hexToNumber(result.knownStates);\n    result.pulledStates = utils.hexToNumber(result.pulledStates);\n  }\n\n  return result;\n};\n\nmodule.exports = {\n  inputDefaultBlockNumberFormatter: inputDefaultBlockNumberFormatter,\n  inputBlockNumberFormatter: inputBlockNumberFormatter,\n  inputCallFormatter: inputCallFormatter,\n  inputTransactionFormatter: inputTransactionFormatter,\n  inputAddressFormatter: inputAddressFormatter,\n  inputPostFormatter: inputPostFormatter,\n  inputLogFormatter: inputLogFormatter,\n  inputSignFormatter: inputSignFormatter,\n  inputStorageKeysFormatter: inputStorageKeysFormatter,\n  outputProofFormatter: outputProofFormatter,\n  outputBigNumberFormatter: outputBigNumberFormatter,\n  outputTransactionFormatter: outputTransactionFormatter,\n  outputTransactionReceiptFormatter: outputTransactionReceiptFormatter,\n  outputBlockFormatter: outputBlockFormatter,\n  outputLogFormatter: outputLogFormatter,\n  outputPostFormatter: outputPostFormatter,\n  outputSyncingFormatter: outputSyncingFormatter\n};","map":{"version":3,"sources":["/Users/mosesvodounou/Projects/BlockChain/Hello_World_Web3/node_modules/web3-core-helpers/lib/formatters.js"],"names":["utils","require","Iban","inputStorageKeysFormatter","keys","map","numberToHex","outputProofFormatter","proof","address","toChecksumAddress","nonce","hexToNumberString","balance","outputBigNumberFormatter","number","toBN","toString","isPredefinedBlockNumber","blockNumber","includes","inputDefaultBlockNumberFormatter","undefined","inputBlockNumberFormatter","defaultBlock","isHexStrict","toLowerCase","_txInputFormatter","options","to","inputAddressFormatter","data","input","Error","startsWith","isHex","gas","gasLimit","maxPriorityFeePerGas","maxFeePerGas","gasPrice","filter","key","forEach","inputCallFormatter","from","defaultAccount","inputTransactionFormatter","inputSignFormatter","utf8ToHex","outputTransactionFormatter","tx","hexToNumber","transactionIndex","type","value","isAddress","outputTransactionReceiptFormatter","receipt","hexFormat","cumulativeGasUsed","gasUsed","effectiveGasPrice","Array","isArray","logs","outputLogFormatter","contractAddress","status","Boolean","parseInt","outputBlockFormatter","block","size","timestamp","difficulty","totalDifficulty","transactions","item","miner","baseFeePerGas","inputLogFormatter","toTopic","String","indexOf","fromUtf8","fromBlock","toBlock","topics","topic","addr","log","blockHash","transactionHash","logIndex","shaId","sha3","replace","id","slice","inputPostFormatter","post","ttl","workToProve","priority","outputPostFormatter","expiry","sent","workProved","toUtf8","iban","isValid","isDirect","toAddress","outputSyncingFormatter","result","startingBlock","currentBlock","highestBlock","knownStates","pulledStates","module","exports"],"mappings":"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","sourcesContent":["/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file formatters.js\n * @author Fabian Vogelsteller <fabian@ethereum.org>\n * @author Marek Kotewicz <marek@parity.io>\n * @date 2017\n */\n\"use strict\";\nvar utils = require('web3-utils');\nvar Iban = require('web3-eth-iban');\n/**\n * Will format the given storage key array values to hex strings.\n *\n * @method inputStorageKeysFormatter\n *\n * @param {Array<Number|String|BN|BigNumber>} keys\n *\n * @returns {Array<String>}\n */\nvar inputStorageKeysFormatter = function (keys) {\n    return keys.map(utils.numberToHex);\n};\n/**\n * Will format the given proof response from the node.\n *\n * @method outputProofFormatter\n *\n * @param {object} proof\n *\n * @returns {object}\n */\nvar outputProofFormatter = function (proof) {\n    proof.address = utils.toChecksumAddress(proof.address);\n    proof.nonce = utils.hexToNumberString(proof.nonce);\n    proof.balance = utils.hexToNumberString(proof.balance);\n    return proof;\n};\n/**\n * Should the format output to a big number\n *\n * @method outputBigNumberFormatter\n *\n * @param {String|Number|BigNumber|BN} number\n *\n * @returns {BN} object\n */\nvar outputBigNumberFormatter = function (number) {\n    return utils.toBN(number).toString(10);\n};\n/**\n * Returns true if the given blockNumber is 'latest', 'pending', 'earliest, 'finalized' or 'safe'\n *\n * @method isPredefinedBlockNumber\n *\n * @param {String} blockNumber\n *\n * @returns {Boolean}\n */\nvar isPredefinedBlockNumber = function (blockNumber) {\n    return ['latest', 'pending', 'earliest', 'finalized', 'safe'].includes(blockNumber);\n};\n/**\n * Returns the given block number as hex string or does return the defaultBlock property of the current module\n *\n * @method inputDefaultBlockNumberFormatter\n *\n * @param {String|Number|BN|BigNumber} blockNumber\n *\n * @returns {String}\n */\nvar inputDefaultBlockNumberFormatter = function (blockNumber) {\n    if (this && (blockNumber === undefined || blockNumber === null)) {\n        return inputBlockNumberFormatter(this.defaultBlock);\n    }\n    return inputBlockNumberFormatter(blockNumber);\n};\n/**\n * Returns the given block number as hex string or the predefined block number 'latest', 'pending', 'earliest', 'finalized', 'safe', 'genesis'\n *\n * @param {String|Number|BN|BigNumber} blockNumber\n *\n * @returns {String}\n */\nvar inputBlockNumberFormatter = function (blockNumber) {\n    if (blockNumber === undefined) {\n        return undefined;\n    }\n    if (isPredefinedBlockNumber(blockNumber)) {\n        return blockNumber;\n    }\n    if (blockNumber === 'genesis') {\n        return '0x0';\n    }\n    return (utils.isHexStrict(blockNumber)) ? ((typeof blockNumber === 'string') ? blockNumber.toLowerCase() : blockNumber) : utils.numberToHex(blockNumber);\n};\n/**\n * Formats the input of a transaction and converts all values to HEX\n *\n * @method _txInputFormatter\n * @param {Object} transaction options\n * @returns object\n */\nvar _txInputFormatter = function (options) {\n    if (options.to) { // it might be contract creation\n        options.to = inputAddressFormatter(options.to);\n    }\n    if (options.data && options.input) {\n        throw new Error('You can\\'t have \"data\" and \"input\" as properties of transactions at the same time, please use either \"data\" or \"input\" instead.');\n    }\n    if (!options.data && options.input) {\n        options.data = options.input;\n        delete options.input;\n    }\n    if (options.data && !options.data.startsWith('0x')) {\n        options.data = '0x' + options.data;\n    }\n    if (options.data && !utils.isHex(options.data)) {\n        throw new Error('The data field must be HEX encoded data.');\n    }\n    // allow both\n    if (options.gas || options.gasLimit) {\n        options.gas = options.gas || options.gasLimit;\n    }\n    if (options.maxPriorityFeePerGas || options.maxFeePerGas) {\n        delete options.gasPrice;\n    }\n    ['gasPrice', 'gas', 'value', 'maxPriorityFeePerGas', 'maxFeePerGas', 'nonce'].filter(function (key) {\n        return options[key] !== undefined;\n    }).forEach(function (key) {\n        options[key] = utils.numberToHex(options[key]);\n    });\n    return options;\n};\n/**\n * Formats the input of a transaction and converts all values to HEX\n *\n * @method inputCallFormatter\n * @param {Object} transaction options\n * @returns object\n */\nvar inputCallFormatter = function (options) {\n    options = _txInputFormatter(options);\n    var from = options.from || (this ? this.defaultAccount : null);\n    if (from) {\n        options.from = inputAddressFormatter(from);\n    }\n    return options;\n};\n/**\n * Formats the input of a transaction and converts all values to HEX\n *\n * @method inputTransactionFormatter\n * @param {Object} options\n * @returns object\n */\nvar inputTransactionFormatter = function (options) {\n    options = _txInputFormatter(options);\n    // check from, only if not number, or object\n    if (!(typeof options.from === 'number') && !(!!options.from && typeof options.from === 'object')) {\n        options.from = options.from || (this ? this.defaultAccount : null);\n        if (!options.from && !(typeof options.from === 'number')) {\n            throw new Error('The send transactions \"from\" field must be defined!');\n        }\n        options.from = inputAddressFormatter(options.from);\n    }\n    return options;\n};\n/**\n * Hex encodes the data passed to eth_sign and personal_sign\n *\n * @method inputSignFormatter\n * @param {String} data\n * @returns {String}\n */\nvar inputSignFormatter = function (data) {\n    return (utils.isHexStrict(data)) ? data : utils.utf8ToHex(data);\n};\n/**\n * Formats the output of a transaction to its proper values\n *\n * @method outputTransactionFormatter\n * @param {Object} tx\n * @returns {Object}\n */\nvar outputTransactionFormatter = function (tx) {\n    if (tx.blockNumber !== null)\n        tx.blockNumber = utils.hexToNumber(tx.blockNumber);\n    if (tx.transactionIndex !== null)\n        tx.transactionIndex = utils.hexToNumber(tx.transactionIndex);\n    tx.nonce = utils.hexToNumber(tx.nonce);\n    tx.gas = utils.hexToNumber(tx.gas);\n    if (tx.gasPrice)\n        tx.gasPrice = outputBigNumberFormatter(tx.gasPrice);\n    if (tx.maxFeePerGas)\n        tx.maxFeePerGas = outputBigNumberFormatter(tx.maxFeePerGas);\n    if (tx.maxPriorityFeePerGas)\n        tx.maxPriorityFeePerGas = outputBigNumberFormatter(tx.maxPriorityFeePerGas);\n    if (tx.type)\n        tx.type = utils.hexToNumber(tx.type);\n    tx.value = outputBigNumberFormatter(tx.value);\n    if (tx.to && utils.isAddress(tx.to)) { // tx.to could be `0x0` or `null` while contract creation\n        tx.to = utils.toChecksumAddress(tx.to);\n    }\n    else {\n        tx.to = null; // set to `null` if invalid address\n    }\n    if (tx.from) {\n        tx.from = utils.toChecksumAddress(tx.from);\n    }\n    return tx;\n};\n/**\n * Formats the output of a transaction receipt to its proper values\n *\n * @method outputTransactionReceiptFormatter\n * @param {Object} receipt\n * @returns {Object}\n */\nvar outputTransactionReceiptFormatter = function (receipt) {\n    if (typeof receipt !== 'object') {\n        throw new Error('Received receipt is invalid: ' + receipt);\n    }\n    if (!this.hexFormat) {\n        if (receipt.blockNumber !== null)\n            receipt.blockNumber = utils.hexToNumber(receipt.blockNumber);\n        if (receipt.transactionIndex !== null)\n            receipt.transactionIndex = utils.hexToNumber(receipt.transactionIndex);\n        receipt.cumulativeGasUsed = utils.hexToNumber(receipt.cumulativeGasUsed);\n        receipt.gasUsed = utils.hexToNumber(receipt.gasUsed);\n        if (receipt.effectiveGasPrice) {\n            receipt.effectiveGasPrice = utils.hexToNumber(receipt.effectiveGasPrice);\n        }\n    }\n    if (Array.isArray(receipt.logs)) {\n        receipt.logs = receipt.logs.map(outputLogFormatter);\n    }\n    if (receipt.contractAddress) {\n        receipt.contractAddress = utils.toChecksumAddress(receipt.contractAddress);\n    }\n    if (typeof receipt.status !== 'undefined' && receipt.status !== null) {\n        receipt.status = Boolean(parseInt(receipt.status));\n    }\n    return receipt;\n};\n/**\n * Formats the output of a block to its proper values\n *\n * @method outputBlockFormatter\n * @param {Object} block\n * @returns {Object}\n */\nvar outputBlockFormatter = function (block) {\n    // transform to number\n    block.gasLimit = utils.hexToNumber(block.gasLimit);\n    block.gasUsed = utils.hexToNumber(block.gasUsed);\n    block.size = utils.hexToNumber(block.size);\n    block.timestamp = utils.hexToNumber(block.timestamp);\n    if (block.number !== null)\n        block.number = utils.hexToNumber(block.number);\n    if (block.difficulty)\n        block.difficulty = outputBigNumberFormatter(block.difficulty);\n    if (block.totalDifficulty)\n        block.totalDifficulty = outputBigNumberFormatter(block.totalDifficulty);\n    if (Array.isArray(block.transactions)) {\n        block.transactions.forEach(function (item) {\n            if (!(typeof item === 'string'))\n                return outputTransactionFormatter(item);\n        });\n    }\n    if (block.miner)\n        block.miner = utils.toChecksumAddress(block.miner);\n    if (block.baseFeePerGas)\n        block.baseFeePerGas = utils.hexToNumber(block.baseFeePerGas);\n    return block;\n};\n/**\n * Formats the input of a log\n *\n * @method inputLogFormatter\n * @param {Object} log object\n * @returns {Object} log\n */\nvar inputLogFormatter = function (options) {\n    var toTopic = function (value) {\n        if (value === null || typeof value === 'undefined')\n            return null;\n        value = String(value);\n        if (value.indexOf('0x') === 0)\n            return value;\n        else\n            return utils.fromUtf8(value);\n    };\n    if (options === undefined)\n        options = {};\n    // If options !== undefined, don't blow out existing data\n    if (options.fromBlock === undefined)\n        options = { ...options, fromBlock: 'latest' };\n    if (options.fromBlock || options.fromBlock === 0)\n        options.fromBlock = inputBlockNumberFormatter(options.fromBlock);\n    if (options.toBlock || options.toBlock === 0)\n        options.toBlock = inputBlockNumberFormatter(options.toBlock);\n    // make sure topics, get converted to hex\n    options.topics = options.topics || [];\n    options.topics = options.topics.map(function (topic) {\n        return (Array.isArray(topic)) ? topic.map(toTopic) : toTopic(topic);\n    });\n    toTopic = null;\n    if (options.address) {\n        options.address = (Array.isArray(options.address)) ? options.address.map(function (addr) {\n            return inputAddressFormatter(addr);\n        }) : inputAddressFormatter(options.address);\n    }\n    return options;\n};\n/**\n * Formats the output of a log\n *\n * @method outputLogFormatter\n * @param {Object} log object\n * @returns {Object} log\n */\nvar outputLogFormatter = function (log) {\n    // generate a custom log id\n    if (typeof log.blockHash === 'string' &&\n        typeof log.transactionHash === 'string' &&\n        typeof log.logIndex === 'string') {\n        var shaId = utils.sha3(log.blockHash.replace('0x', '') + log.transactionHash.replace('0x', '') + log.logIndex.replace('0x', ''));\n        log.id = 'log_' + shaId.replace('0x', '').slice(0, 8);\n    }\n    else if (!log.id) {\n        log.id = null;\n    }\n    if (log.blockNumber !== null)\n        log.blockNumber = utils.hexToNumber(log.blockNumber);\n    if (log.transactionIndex !== null)\n        log.transactionIndex = utils.hexToNumber(log.transactionIndex);\n    if (log.logIndex !== null)\n        log.logIndex = utils.hexToNumber(log.logIndex);\n    if (log.address) {\n        log.address = utils.toChecksumAddress(log.address);\n    }\n    return log;\n};\n/**\n * Formats the input of a whisper post and converts all values to HEX\n *\n * @method inputPostFormatter\n * @param {Object} transaction object\n * @returns {Object}\n */\nvar inputPostFormatter = function (post) {\n    // post.payload = utils.toHex(post.payload);\n    if (post.ttl)\n        post.ttl = utils.numberToHex(post.ttl);\n    if (post.workToProve)\n        post.workToProve = utils.numberToHex(post.workToProve);\n    if (post.priority)\n        post.priority = utils.numberToHex(post.priority);\n    // fallback\n    if (!Array.isArray(post.topics)) {\n        post.topics = post.topics ? [post.topics] : [];\n    }\n    // format the following options\n    post.topics = post.topics.map(function (topic) {\n        // convert only if not hex\n        return (topic.indexOf('0x') === 0) ? topic : utils.fromUtf8(topic);\n    });\n    return post;\n};\n/**\n * Formats the output of a received post message\n *\n * @method outputPostFormatter\n * @param {Object}\n * @returns {Object}\n */\nvar outputPostFormatter = function (post) {\n    post.expiry = utils.hexToNumber(post.expiry);\n    post.sent = utils.hexToNumber(post.sent);\n    post.ttl = utils.hexToNumber(post.ttl);\n    post.workProved = utils.hexToNumber(post.workProved);\n    // post.payloadRaw = post.payload;\n    // post.payload = utils.hexToAscii(post.payload);\n    // if (utils.isJson(post.payload)) {\n    //     post.payload = JSON.parse(post.payload);\n    // }\n    // format the following options\n    if (!post.topics) {\n        post.topics = [];\n    }\n    post.topics = post.topics.map(function (topic) {\n        return utils.toUtf8(topic);\n    });\n    return post;\n};\nvar inputAddressFormatter = function (address) {\n    var iban = new Iban(address);\n    if (iban.isValid() && iban.isDirect()) {\n        return iban.toAddress().toLowerCase();\n    }\n    else if (utils.isAddress(address)) {\n        return '0x' + address.toLowerCase().replace('0x', '');\n    }\n    throw new Error(`Provided address ${address} is invalid, the capitalization checksum test failed, or it's an indirect IBAN address which can't be converted.`);\n};\nvar outputSyncingFormatter = function (result) {\n    result.startingBlock = utils.hexToNumber(result.startingBlock);\n    result.currentBlock = utils.hexToNumber(result.currentBlock);\n    result.highestBlock = utils.hexToNumber(result.highestBlock);\n    if (result.knownStates) {\n        result.knownStates = utils.hexToNumber(result.knownStates);\n        result.pulledStates = utils.hexToNumber(result.pulledStates);\n    }\n    return result;\n};\nmodule.exports = {\n    inputDefaultBlockNumberFormatter: inputDefaultBlockNumberFormatter,\n    inputBlockNumberFormatter: inputBlockNumberFormatter,\n    inputCallFormatter: inputCallFormatter,\n    inputTransactionFormatter: inputTransactionFormatter,\n    inputAddressFormatter: inputAddressFormatter,\n    inputPostFormatter: inputPostFormatter,\n    inputLogFormatter: inputLogFormatter,\n    inputSignFormatter: inputSignFormatter,\n    inputStorageKeysFormatter: inputStorageKeysFormatter,\n    outputProofFormatter: outputProofFormatter,\n    outputBigNumberFormatter: outputBigNumberFormatter,\n    outputTransactionFormatter: outputTransactionFormatter,\n    outputTransactionReceiptFormatter: outputTransactionReceiptFormatter,\n    outputBlockFormatter: outputBlockFormatter,\n    outputLogFormatter: outputLogFormatter,\n    outputPostFormatter: outputPostFormatter,\n    outputSyncingFormatter: outputSyncingFormatter\n};\n"]},"metadata":{},"sourceType":"script"}